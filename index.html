<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>B935016 고영광</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>html,body{background:#000}</style>
</head>
<body class="bg-black text-white">
  <div id="root"></div>
  <script type="text/babel">
    const defaultWorks = [
      { id: 1, key: "Dubhe",  label: "프로필", desc: "소개 / 연락처 / 링크", href: "/profile/",   deck: [] },
      { id: 2, key: "Merak",  label: "2-2",   desc: "프로젝트 2-2",       href: "/work/2-2/",  deck: [] },
      { id: 3, key: "Phecda", label: "3-1",   desc: "프로젝트 3-1",       href: "/work/3-1/",  deck: [] },
      { id: 4, key: "Megrez", label: "3-2",   desc: "프로젝트 3-2",       href: "/work/3-2/",  deck: [] },
      { id: 5, key: "Alioth", label: "4-1",   desc: "프로젝트 4-1",       href: "/work/4-1/",  deck: [] },
      { id: 6, key: "Mizar",  label: "4-2",   desc: "프로젝트 4-2",       href: "/work/4-2/",  deck: [] },
      { id: 7, key: "Alkaid", label: "5-1",   desc: "Co-siwon",           href: "/work/5-1/",  deck: [] },
    ];

    const starLayout = [
      { id: 1, x: 10, y: 20 }, { id: 2, x: 16, y: 50 }, { id: 3, x: 36, y: 60 },
      { id: 4, x: 47, y: 40 }, { id: 5, x: 62, y: 34 }, { id: 6, x: 73, y: 30 },
      { id: 7, x: 86, y: 36 },
    ];
    const mergeWorksWithLayout = (works) => starLayout.map((p,i)=>({ ...p, ...(works[i]||{}), index:i }));

    function Node({ data, onHover, onClickNode }) {
      const x = data?.x ?? 0, y = data?.y ?? 0;
      const label = data?.label ?? '';
      const rOuter = 1.15, rCore = 0.48;
      const [hoverKey, setHoverKey] = React.useState(0);
      const [clickKey, setClickKey] = React.useState(0);

      const handleEnter = () => onHover?.({ label: data?.label ?? '', desc: data?.desc ?? '', href: data?.href ?? '' });
      const handleLeave = () => onHover?.(null);
      const handleClick = () => { setClickKey(k=>k+1); onClickNode?.(); };

      return (
        <g transform={`translate(${x} ${y})`}>
          <g role="button" tabIndex={0} style={{outline:'none', cursor:'pointer'}} aria-label={label}
             onClick={handleClick}
             onKeyDown={(e)=>{ if(e.key==='Enter'||e.key===' ') handleClick(); }}
             onMouseEnter={()=>{ setHoverKey(k=>k+1); handleEnter(); }}
             onMouseLeave={handleLeave}
             onFocus={()=>{ setHoverKey(k=>k+1); handleEnter(); }}
             onBlur={handleLeave}>
            <title>{label}</title>
            <circle r={4.8} fill="transparent" />
            <circle r={rOuter} fill="rgba(255,255,255,0.20)">
              <animate attributeName="r" values={`${rOuter};${rOuter + 0.9};${rOuter}`} dur="2.6s" repeatCount="indefinite" />
              <animate attributeName="opacity" values="0.22;0.12;0.22" dur="2.6s" repeatCount="indefinite" />
            </circle>
            <circle r={rCore} fill="#ffffff" filter="url(#glow)">
              <animate attributeName="r" values={`${rCore};${rCore + 0.34};${rCore}`} dur="1.7s" repeatCount="indefinite" />
            </circle>

            {/* Hover sparkle (작게) */}
            <SparkBurst key={'h'+hoverKey} scale={1} strength={0.9} />

            {/* Click sparkle (더 강하게) */}
            <SparkBurst key={'c'+clickKey} scale={1.25} strength={1.4} />
          </g>
        </g>
      );
    }

    function SparkBurst({ scale=1, strength=1 }){
      // strength에 따라 반경/밝기 증가
      const count = 12;
      return (
        <g className="spark-burst" style={{ transformOrigin:'center', transform:`scale(${scale})` }}>
          <circle r={1.0*strength} fill="rgba(255,255,255,0.10)" filter="url(#glow)" className="spark" />
          {Array.from({length:count}).map((_,i)=>{
            const ang = (i / count) * Math.PI * 2;
            const dist = 0.85 + ((i % 3) * 0.16) * strength;
            const rx = Math.cos(ang) * dist, ry = Math.sin(ang) * dist;
            const rr = (0.10 + ((i % 3) * 0.04)) * strength;
            const c  = i % 2 === 0 ? 'rgba(255,255,255,0.95)' : 'rgba(190,220,255,0.9)';
            return (
              <g key={i} transform={`translate(${rx} ${ry})`}>
                <circle r={rr} fill={c} stroke="white" strokeWidth={0.05} filter="url(#glow)" className="spark" />
                <g className="spark">
                  <line x1={-rr*1.8} y1={0} x2={rr*1.8} y2={0} stroke={c} strokeWidth={0.09} strokeLinecap="round" />
                  <line x1={0} y1={-rr*1.8} x2={0} y2={rr*1.8} stroke={c} strokeWidth={0.09} strokeLinecap="round" />
                </g>
              </g>
            );
          })}
        </g>
      );
    }

    function BigDipperPortfolio({
      works = defaultWorks,
      title = "B935016 고영광",
      backgroundMode = "image",
      backgroundImageUrl = "https://images.unsplash.com/photo-1523986371872-9d3ba2e2b1b9?q=80&w=1600&auto=format&fit=crop",
      canvasAspect = "16/9",
      dipperScaleX = 0.85,
      dipperScale = 0.8,
      dipperRotateDeg = 205,
      dipperPivotIndex = 4,
      dipperOffsetX = 0,
      dipperOffsetY = 0,
      dipperMirrorX = true,
    }) {
      const [bgOk, setBgOk] = React.useState(true);
      const [customBgDataUrl, setCustomBgDataUrl] = React.useState("");
      const [active, setActive] = React.useState(null);
      const [aspect, setAspect] = React.useState(canvasAspect);
      const fileInputRef = React.useRef(null);
      const [controlsVisible, setControlsVisible] = React.useState(true);
      const [editMode, setEditMode] = React.useState(false);
      const [items, setItems] = React.useState(works);

      // 초기 Co-siwon 보정
      React.useEffect(()=>{
        setItems(prev=>{
          if(!Array.isArray(prev)||prev.length!==7) return prev;
          if(prev[6]?.desc==='Co-siwon') return prev;
          const n=prev.slice(); n[6]={...(n[6]||{}), desc:'Co-siwon'}; return n;
        });
      },[]);

      // UI 표시 토글: URL/저장값 + U키
      React.useEffect(() => {
        try {
          const q = new URLSearchParams(location.search);
          const uiQ = (q.get('ui') || '').toLowerCase();
          const hash = (location.hash || '').replace('#','');
          const uiH = hash.split('&').find(s=>s.startsWith('ui='));
          const uiFromUrl = (uiQ || (uiH?uiH.split('=')[1]:''))?.toLowerCase();
          const saved = (localStorage.getItem('dipper:ui') || 'show').toLowerCase();
          const initial = uiFromUrl || saved;
          setControlsVisible(initial !== 'off' && initial !== 'hide');
        } catch {}
      }, []);
      React.useEffect(()=>{ try{ localStorage.setItem('dipper:ui', controlsVisible?'show':'hide'); }catch{} },[controlsVisible]);
      React.useEffect(()=>{
        const onKey = (e)=>{
          const tag=(e.target?.tagName||'').toLowerCase();
          const typing=['input','textarea','select'].includes(tag) || (e.target && e.target.isContentEditable);
          if(!typing && (e.key==='u'||e.key==='U')) setControlsVisible(v=>!v);
        };
        window.addEventListener('keydown', onKey);
        return ()=>window.removeEventListener('keydown', onKey);
      },[]);

      // 저장 로드
      React.useEffect(()=>{
        try{ const bg=localStorage.getItem('dipper:bg'); if(bg) setCustomBgDataUrl(bg);}catch{}
        try{
          const w=localStorage.getItem('dipper:works');
          if(w){ const j=JSON.parse(w); if(Array.isArray(j)&&j.length===7) setItems(j); }
        }catch{}
      },[]);
      React.useEffect(()=>{ try{ localStorage.setItem('dipper:works', JSON.stringify(items)); }catch{} },[items]);

      const bgHref = (customBgDataUrl && typeof customBgDataUrl==='string' && customBgDataUrl.length>0) ? customBgDataUrl : backgroundImageUrl;
      React.useEffect(()=>{ document.title = title; },[title]);

      // 좌표 파이프라인
      const aspectScale = React.useMemo(()=>({ w:16, h:9, k:16/9 }),[]);
      const nodesBase   = React.useMemo(()=>mergeWorksWithLayout(items),[items]);
      const nodesScaled = React.useMemo(()=>nodesBase.map(n=>({...n, x:n.x*aspectScale.k})),[nodesBase,aspectScale.k]);
      const nodesAdjusted = React.useMemo(()=>{
        const cx=(100*aspectScale.k)/2, s=Math.max(0.5,Math.min(1,dipperScaleX));
        return nodesScaled.map(n=>({...n, x: cx+(n.x-cx)*s }));
      },[nodesScaled,aspectScale.k,dipperScaleX]);
      const nodesSized = React.useMemo(()=>{
        const cx=(100*aspectScale.k)/2, cy=50, s=Math.max(0.6,Math.min(1.2,dipperScale));
        return nodesAdjusted.map(n=>({...n, x: cx+(n.x-cx)*s, y: cy+(n.y-cy)*s }));
      },[nodesAdjusted,aspectScale.k,dipperScale]);
      const nodesFinal = React.useMemo(()=>{
        const cx=(100*aspectScale.k)/2, cy=50;
        const pivotIdx=Math.max(1,Math.min(7,dipperPivotIndex))-1;
        const pivot=nodesSized[pivotIdx]||{x:cx,y:cy};
        const rad=(Math.PI/180)*(dipperRotateDeg||0);
        const cos=Math.cos(rad), sin=Math.sin(rad);
        return nodesSized.map(n=>{
          const dx=n.x-pivot.x, dy=n.y-pivot.y;
          return {...n, x:pivot.x+dx*cos-dy*sin+dipperOffsetX, y:pivot.y+dx*sin+dy*cos+dipperOffsetY};
        });
      },[nodesSized,aspectScale.k,dipperRotateDeg,dipperOffsetX,dipperOffsetY,dipperPivotIndex]);
      const nodesScreen = React.useMemo(()=>{
        if(!dipperMirrorX) return nodesFinal;
        const cx=(100*aspectScale.k)/2;
        return nodesFinal.map(n=>({...n, x: cx*2 - n.x }));
      },[nodesFinal,dipperMirrorX,aspectScale.k]);
      const polylinePoints = React.useMemo(()=>nodesScreen.map(n=>`${n.x},${n.y}`).join(' '),[nodesScreen]);

      return (
        <main className="relative min-h-screen w-full bg-black text-white overflow-hidden">
          <div aria-hidden className="pointer-events-none absolute inset-0 opacity-80" style={{ background: 'radial-gradient(circle at 50% 50%, #000010 0%, #000000 80%)' }} />

          {/* UI 숨김 토글 버튼 (숨겨진 상태에서만) */}
          {!controlsVisible && (
            <button aria-label="Show UI" onClick={()=>setControlsVisible(true)}
              className="fixed top-2 left-2 z-50 px-2 py-1 text-[12px] rounded bg-white/10 hover:bg-white/15 border border-white/20 text-white/80">
              UI
            </button>
          )}

          {/* 헤더 + 컨트롤 (controlsVisible 일 때만 보임) */}
          {controlsVisible && (
            <header className="relative z-10 mx-auto max-w-5xl px-6 pt-10 pb-6 flex items-center justify-between">
              <h1 className="text-2xl md:text-3xl font-semibold tracking-tight">{title}</h1>
              <div className="flex items-center gap-2">
                <button onClick={()=>setEditMode(v=>!v)}
                  className={"text-xs md:text-sm px-3 py-1.5 rounded-xl border " + (editMode ? 'bg-teal-500/20 border-teal-400/40' : 'bg-white/10 hover:bg-white/15 border-white/15')}>
                  {editMode ? '편집 모드: ON' : '편집 모드'}
                </button>
                <button onClick={()=>{ if(fileInputRef.current) fileInputRef.current.click(); }}
                  className="text-xs md:text-sm px-3 py-1.5 rounded-xl bg-white/10 hover:bg-white/15 border border-white/15">배경 이미지 선택</button>
                <input ref={fileInputRef} type="file" accept="image/*" className="hidden" onChange={(e)=>{
                  const f = e.target?.files?.[0]; if(!f) return;
                  const reader=new FileReader();
                  reader.onload=(ev)=>{
                    const dataUrl = String(ev?.target?.result || '');
                    setCustomBgDataUrl(dataUrl); setBgOk(true);
                    try{ localStorage.setItem('dipper:bg', dataUrl); }catch(err){ console.error('[BigDipper] save bg failed', err); }
                  };
                  reader.readAsDataURL(f);
                }} />
                <button onClick={()=>{
                    try{
                      const data=JSON.stringify(items,null,2);
                      const blob=new Blob([data],{type:'application/json'});
                      const url=URL.createObjectURL(blob);
                      const a=document.createElement('a'); a.href=url; a.download='dipper-works.json'; a.click();
                      setTimeout(()=>URL.revokeObjectURL(url), 500);
                    }catch(e){ console.error('export failed', e); }
                  }}
                  className="text-xs md:text-sm px-3 py-1.5 rounded-xl bg-white/10 hover:bg-white/15 border border-white/15">내보내기</button>
                <label className="text-xs md:text-sm px-3 py-1.5 rounded-xl bg-white/10 hover:bg-white/15 border border-white/15 cursor-pointer">
                  가져오기
                  <input type="file" accept="application/json" className="hidden" onChange={async (e)=>{
                    const f=e.target?.files?.[0]; if(!f) return;
                    try{
                      const text=await f.text();
                      const json=JSON.parse(text);
                      if(Array.isArray(json)&&json.length===7) setItems(json);
                      else alert('형식이 올바르지 않습니다. 7개 항목 배열이어야 해요.');
                    }catch(err){ console.error('import failed', err); }
                  }} />
                </label>
                <button onClick={()=>setControlsVisible(false)} className="text-xs md:text-sm px-3 py-1.5 rounded-xl bg-white/10 hover:bg-white/15 border border-white/15">UI 숨기기</button>
              </div>
            </header>
          )}

          <div className="relative z-10 mx-auto max-w-5xl px-6 mt-6 pb-3">
            <div className="flex items-center gap-2 text-[13px] md:text-sm text-white/80">
              <span role="img" aria-label="star">⭐</span>
              <span>별을 클릭하면 프로젝트로 이동합니다</span>
            </div>
          </div>

          {/* 편집 패널 (controlsVisible && editMode 일 때만 편집 가능) */}
          {controlsVisible && (
            <section className="relative z-10 mx-auto max-w-5xl w-full px-4 pb-4">
              <div className="grid md:grid-cols-2 gap-4">
                {items.map((it, i) => (
                  <div key={i} className={"rounded-xl border p-3 " + (editMode ? "border-white/15 bg-white/5" : "border-white/10 bg-white/3 opacity-70")}>
                    <div className="text-xs text-white/70 mb-2">노드 {i+1} – {it.key}</div>
                    <div className="grid grid-cols-3 gap-2">
                      <label className="col-span-1 text-xs text-white/70">제목</label>
                      <input disabled={!editMode} className="col-span-2 bg-black/30 border border-white/15 rounded-md px-2 py-1 text-sm disabled:opacity-60 disabled:cursor-not-allowed"
                        value={it.label} onChange={(e)=>{
                          const v=e.target.value; setItems(items.map((p,j)=> j===i?{...p,label:v}:p));
                        }} />
                      <label className="col-span-1 text-xs text-white/70">설명</label>
                      <input disabled={!editMode} className="col-span-2 bg-black/30 border border-white/15 rounded-md px-2 py-1 text-sm disabled:opacity-60 disabled:cursor-not-allowed"
                        value={it.desc} onChange={(e)=>{
                          const v=e.target.value; setItems(items.map((p,j)=> j===i?{...p,desc:v}:p));
                        }} />
                      <label className="col-span-1 text-xs text-white/70">링크</label>
                      <input disabled={!editMode} className="col-span-2 bg-black/30 border border-white/15 rounded-md px-2 py-1 text-sm disabled:opacity-60 disabled:cursor-not-allowed"
                        value={it.href} onChange={(e)=>{
                          const v=e.target.value; setItems(items.map((p,j)=> j===i?{...p,href:v}:p));
                        }} />
                    </div>
                  </div>
                ))}
              </div>
            </section>
          )}

          {/* 캔버스 */}
          <section className="relative z-10 mx-auto max-w-5xl w-full px-4 pb-16">
            <div className="relative w-full rounded-2xl border border-white/10 shadow-2xl overflow-hidden" style={{ aspectRatio: '16/9' }}>
              <svg viewBox={`0 0 ${100 * (16/9)} 100`} preserveAspectRatio="xMidYMid meet" className="h-full w-full">
                <defs>
                  <linearGradient id="blueCast" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0%" stopColor="#0e1a3a" />
                    <stop offset="100%" stopColor="#0a0f23" />
                  </linearGradient>
                  <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="1.1" result="coloredBlur" />
                    <feMerge><feMergeNode in="coloredBlur" /><feMergeNode in="SourceGraphic" /></feMerge>
                  </filter>
                  <style>{`
                    svg *:focus { outline: none; }
                    @keyframes sparkle { 0% { opacity: 0; transform: scale(0.7); } 20% { opacity: 1; } 100% { opacity: 0; transform: scale(1.35); } }
                    .spark-burst { pointer-events: none; }
                    .spark { transform-origin: center; animation: sparkle 550ms ease-out forwards; }
                  `}</style>
                </defs>

                {(backgroundMode === 'image' && (customBgDataUrl || backgroundImageUrl) && bgOk) ? (
                  <image href={(customBgDataUrl || backgroundImageUrl)} x="0" y="0" width={100*(16/9)} height="100" preserveAspectRatio="xMidYMid slice" crossOrigin="anonymous" onError={()=>setBgOk(false)} />
                ) : (
                  <rect x="0" y="0" width={100*(16/9)} height="100" fill="#0b1024" />
                )}
                <rect x="0" y="0" width={100*(16/9)} height="100" fill="url(#blueCast)" opacity="0.25" />

                <polyline points={polylinePoints} fill="none" stroke="rgba(255,255,255,0.18)" strokeWidth="0.55" strokeLinejoin="round" strokeLinecap="round" vectorEffect="non-scaling-stroke" filter="url(#glow)" />
                <polyline points={polylinePoints} fill="none" stroke="rgba(255,255,255,0.35)" strokeWidth="0.35" strokeLinejoin="round" strokeLinecap="round" vectorEffect="non-scaling-stroke" filter="url(#glow)" />

                {nodesScreen.map((n, idx) => (
                  <Node key={n.id ?? idx} data={n}
                    onHover={setActive}
                    onClickNode={() => {
                      const href = (items[idx] && items[idx].href) ? items[idx].href : '#';
                      setTimeout(()=>{ try{ window.open(href, '_blank', 'noreferrer'); }catch{} }, 80);
                    }}
                  />
                ))}
              </svg>

              {/* 정보 패널 */}
              <div className="pointer-events-none absolute right-3 bottom-3 md:right-4 md:bottom-4">
                <div className={("transition-all duration-200 backdrop-blur-md rounded-xl border border-white/15 shadow-lg " + (active ? 'bg-black/35 opacity-100 translate-y-0' : 'bg-black/20 opacity-0 translate-y-2') + ' max-w-[70vw] md:max-w-sm')} style={{ pointerEvents: 'none' }}>
                  <div className="px-4 py-3">
                    <div className="text-xs uppercase tracking-wider text-white/60">Project</div>
                    <div className="mt-0.5 text-base md:text-lg font-medium">{active?.label || '노드에 마우스를 올려보세요'}</div>
                    <div className="mt-1 text-xs md:text-sm text-white/75 leading-snug line-clamp-3">{active?.desc || '우측하단에 프로젝트 이름과 설명이 표시됩니다.'}</div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </main>
      );
    }

    function AppWrapper(props){ return <BigDipperPortfolio {...props} />; }
    ReactDOM.createRoot(document.getElementById('root')).render(<AppWrapper />);
  </script>
</body>
</html>
