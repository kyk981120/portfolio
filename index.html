<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>B935016 고영광</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>html,body{background:#000}</style>
</head>
<body class="bg-black text-white">
  <!-- 항상 보이는 제목 -->
  <div class="fixed top-3 left-4 z-40 text-white/90 pointer-events-none">
    <h1 class="text-lg md:text-2xl font-semibold tracking-tight">B935016 고영광</h1>
  </div>

  <div id="root"></div>
  <script type="text/babel">
    /* ============ 기본 데이터 ============ */
    const defaultWorks = [
      { id: 1, key: "Dubhe",  label: "프로필", desc: "소개 / 연락처 / 링크", href: "/profile/",   deck: [] },
      { id: 2, key: "Merak",  label: "2-2",   desc: "프로젝트 2-2",       href: "/work/2-2/",  deck: [] },
      { id: 3, key: "Phecda", label: "3-1",   desc: "프로젝트 3-1",       href: "/work/3-1/",  deck: [] },
      { id: 4, key: "Megrez", label: "3-2",   desc: "프로젝트 3-2",       href: "/work/3-2/",  deck: [] },
      { id: 5, key: "Alioth", label: "4-1",   desc: "프로젝트 4-1",       href: "/work/4-1/",  deck: [] },
      { id: 6, key: "Mizar",  label: "4-2",   desc: "프로젝트 4-2",       href: "/work/4-2/",  deck: [] },
      { id: 7, key: "Alkaid", label: "5-1",   desc: "Co-siwon",           href: "/work/5-1/",  deck: [] },
    ];
    const starLayout = [
      { id: 1, x: 10, y: 20 }, { id: 2, x: 16, y: 50 }, { id: 3, x: 36, y: 60 },
      { id: 4, x: 47, y: 40 }, { id: 5, x: 62, y: 34 }, { id: 6, x: 73, y: 30 },
      { id: 7, x: 86, y: 36 },
    ];
    const mergeWorksWithLayout = (works) => starLayout.map((p,i)=>({ ...p, ...(works[i]||{}), index:i }));

    /* ============ 스파클 ============ */
    function SparkBurst({ scale=1, strength=1 }){
      const count = 12;
      return (
        <g className="spark-burst" style={{ transformOrigin:'center', transform:`scale(${scale})` }}>
          <circle r={1.0*strength} fill="rgba(255,255,255,0.10)" filter="url(#glow)" className="spark" />
          {Array.from({length:count}).map((_,i)=>{
            const ang = (i / count) * Math.PI * 2;
            const dist = 0.85 + ((i % 3) * 0.16) * strength;
            const rx = Math.cos(ang) * dist, ry = Math.sin(ang) * dist;
            const rr = (0.10 + ((i % 3) * 0.04)) * strength;
            const c  = i % 2 === 0 ? 'rgba(255,255,255,0.95)' : 'rgba(190,220,255,0.9)';
            return (
              <g key={i} transform={`translate(${rx} ${ry})`}>
                <circle r={rr} fill={c} stroke="white" strokeWidth={0.05} filter="url(#glow)" className="spark" />
                <g className="spark">
                  <line x1={-rr*1.8} y1={0} x2={rr*1.8} y2={0} stroke={c} strokeWidth={0.09} strokeLinecap="round" />
                  <line x1={0} y1={-rr*1.8} x2={0} y2={rr*1.8} stroke={c} strokeWidth={0.09} strokeLinecap="round" />
                </g>
              </g>
            );
          })}
        </g>
      );
    }

    /* ============ 노드 ============ */
    function Node({ data, onHover, onClickNode }) {
      const x = data?.x ?? 0, y = data?.y ?? 0;
      const label = data?.label ?? '';
      const rOuter = 1.15, rCore = 0.48;
      const [hoverKey, setHoverKey] = React.useState(0);
      const [clickKey, setClickKey] = React.useState(0);
      const handleEnter = () => onHover?.({ label: data?.label ?? '', desc: data?.desc ?? '', href: data?.href ?? '' });
      const handleLeave = () => onHover?.(null);
      const handleClick = () => { setClickKey(k=>k+1); onClickNode?.(); };

      return (
        <g transform={`translate(${x} ${y})`}>
          <g role="button" tabIndex={0} style={{outline:'none', cursor:'pointer'}} aria-label={label}
             onClick={handleClick}
             onKeyDown={(e)=>{ if(e.key==='Enter'||e.key===' ') handleClick(); }}
             onMouseEnter={()=>{ setHoverKey(k=>k+1); handleEnter(); }}
             onMouseLeave={handleLeave}
             onFocus={()=>{ setHoverKey(k=>k+1); handleEnter(); }}
             onBlur={handleLeave}>
            <title>{label}</title>
            <circle r={4.8} fill="transparent" />
            <circle r={rOuter} fill="rgba(255,255,255,0.20)">
              <animate attributeName="r" values={`${rOuter};${rOuter + 0.9};${rOuter}`} dur="2.6s" repeatCount="indefinite" />
              <animate attributeName="opacity" values="0.22;0.12;0.22" dur="2.6s" repeatCount="indefinite" />
            </circle>
            <circle r={rCore} fill="#ffffff" filter="url(#glow)">
              <animate attributeName="r" values={`${rCore};${rCore + 0.34};${rCore}`} dur="1.7s" repeatCount="indefinite" />
            </circle>
            <SparkBurst key={'h'+hoverKey} scale={1} strength={0.9} />
            <SparkBurst key={'c'+clickKey} scale={1.25} strength={1.4} />
          </g>
        </g>
      );
    }

    /* ============ PPT 슬라이드 모달 ============ */
    function DeckModal({ open, onClose, deck, idx, setIdx }){
      if(!open) return null;
      const cur = deck[idx] || {};
      const goto = (d) => setIdx((i)=>{
        if(deck.length===0) return 0;
        const n=(i+d+deck.length)%deck.length; return n;
      });
      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70">
          <div className="bg-[#0b0f1a] text-white w-[min(92vw,1000px)] rounded-xl border border-white/10 shadow-2xl overflow-hidden">
            <div className="flex items-center justify-between px-4 py-3 border-b border-white/10">
              <div className="text-sm text-white/70">슬라이드 {deck.length? idx+1:0} / {deck.length}</div>
              <button onClick={onClose} className="px-3 py-1 rounded bg-white/10 hover:bg-white/20 text-sm">닫기</button>
            </div>
            <div className="grid md:grid-cols-2 gap-0">
              <div className="p-4 md:p-6 border-b md:border-b-0 md:border-r border-white/10">
                {cur.image ? (
                  <img src={cur.image} alt="" className="w-full h-[48vh] object-contain rounded-md" />
                ) : (
                  <div className="w-full h-[48vh] grid place-items-center text-white/50 text-sm">이미지 없음</div>
                )}
              </div>
              <div className="p-4 md:p-6">
                <div className="text-lg font-semibold">{cur.title || '제목 없음'}</div>
                <div className="mt-2 whitespace-pre-wrap leading-relaxed text-white/80">{cur.text || '설명 없음'}</div>
              </div>
            </div>
            <div className="flex items-center justify-between px-4 py-3 border-t border-white/10">
              <div className="text-xs text-white/60">좌우 화살표로 넘기기</div>
              <div className="flex items-center gap-2">
                <button onClick={()=>goto(-1)} className="px-3 py-1 rounded bg-white/10 hover:bg-white/20 text-sm">이전</button>
                <button onClick={()=>goto(+1)} className="px-3 py-1 rounded bg-white/10 hover:bg-white/20 text-sm">다음</button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    /* ============ 메인 컴포넌트 ============ */
    function BigDipperPortfolio({
      works = defaultWorks,
      backgroundImageUrl = "https://images.unsplash.com/photo-1523986371872-9d3ba2e2b1b9?q=80&w=1600&auto=format&fit=crop",
    }) {
      const [bgOk, setBgOk] = React.useState(true);
      const [customBgDataUrl, setCustomBgDataUrl] = React.useState("");
      const [active, setActive] = React.useState(null);
      const fileInputRef = React.useRef(null);
      const [controlsVisible, setControlsVisible] = React.useState(true);
      const [editMode, setEditMode] = React.useState(false);
      const [items, setItems] = React.useState(works);

      // 모달 상태
      const [deckOpen, setDeckOpen] = React.useState(false);
      const [deckNode, setDeckNode] = React.useState(0);
      const [deckSlide, setDeckSlide] = React.useState(0);

      // U 토글 & 화살표
      React.useEffect(() => {
        const handler = (e) => {
          const tag=(e.target?.tagName||'').toUpperCase();
          const typing=['INPUT','TEXTAREA','SELECT'].includes(tag) || (e.target && e.target.isContentEditable);
          if (typing) return;
          if (e.ctrlKey || e.metaKey || e.altKey) return;
          const key=(e.key||'').toLowerCase();
          if (key==='u') { e.preventDefault(); setControlsVisible(v=>!v); }
          if (deckOpen && (key==='arrowleft' || key==='arrowright')) {
            e.preventDefault();
            setDeckSlide((i)=>{
              const d = key==='arrowleft' ? -1 : 1;
              const deck = items[deckNode]?.deck || [];
              if(deck.length===0) return 0;
              return (i+d+deck.length)%deck.length;
            });
          }
        };
        document.addEventListener('keydown', handler, { capture: true });
        return () => document.removeEventListener('keydown', handler, { capture: true });
      }, [deckOpen, deckNode, items]);

      // 로컬 저장
      React.useEffect(()=>{ try{ const bg=localStorage.getItem('dipper:bg'); if(bg) setCustomBgDataUrl(bg);}catch{} },[]);
      React.useEffect(()=>{ try{ localStorage.setItem('dipper:works', JSON.stringify(items)); }catch{} },[items]);

      const bgHref = (customBgDataUrl && typeof customBgDataUrl==='string' && customBgDataUrl.length>0) ? customBgDataUrl : backgroundImageUrl;

      // 좌표
      const aspectK = 16/9;
      const nodes = React.useMemo(()=>{
        const base = mergeWorksWithLayout(items).map(n=>({ ...n, x: n.x*aspectK }));
        const cx=(100*aspectK)/2, cy=50, sX=0.85, s=0.8;
        const adj = base.map(n=>({ ...n, x: cx+(n.x-cx)*sX }));
        const sized = adj.map(n=>({ ...n, x: cx+(n.x-cx)*s, y: cy+(n.y-cy)*s }));
        const mirrored = sized.map(n=>({ ...n, x: (cx*2)-n.x }));
        const pivot = mirrored[3]; const rad = Math.PI*205/180;
        const cos=Math.cos(rad), sin=Math.sin(rad);
        return mirrored.map(n=>({ ...n, x: pivot.x + (n.x-pivot.x)*cos - (n.y-pivot.y)*sin, y: pivot.y + (n.x-pivot.x)*sin + (n.y-pivot.y)*cos }));
      },[items]);
      const points = nodes.map(n => `${n.x},${n.y}`).join(' ');

      const openNode = (idx) => {
        const deck = items[idx]?.deck || [];
        if(deck.length>0){
          setDeckNode(idx);
          setDeckSlide(0);
          setDeckOpen(true);
        }else{
          const href = items[idx]?.href || '#';
          try{ window.open(href, '_blank', 'noreferrer'); }catch{}
        }
      };

      const upsertSlideImage = (idx, sidx, file) => {
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          const dataUrl = String(ev?.target?.result || '');
          setItems(prev => prev.map((w,i)=>{
            if(i!==idx) return w;
            const deck = Array.isArray(w.deck)? w.deck.slice(): [];
            deck[sidx] = { ...(deck[sidx]||{}), image: dataUrl };
            return { ...w, deck };
          }));
        };
        reader.readAsDataURL(file);
      };

      return (
        <main className="relative min-h-screen w-full bg-black text-white overflow-hidden">
          <div aria-hidden className="pointer-events-none absolute inset-0 opacity-80" style={{ background: 'radial-gradient(circle at 50% 50%, #000010 0%, #000000 80%)' }} />

          {!controlsVisible && (
            <button aria-label="Show UI" onClick={()=>setControlsVisible(true)}
              className="fixed top-2 left-2 z-50 px-2 py-1 text-[12px] rounded bg-white/10 hover:bg-white/15 border border-white/20 text-white/80">
              UI
            </button>
          )}

          {/* 안내 문구 (잘림 방지: mt-6) */}
          <div className="relative z-10 mx-auto max-w-5xl px-6 mt-6 pb-3">
            <div className="flex items-center gap-2 text-[13px] md:text-sm text-white/80">
              <span role="img" aria-label="star">⭐</span>
              <span>별을 클릭하면 프로젝트로 이동합니다</span>
            </div>
          </div>

          {controlsVisible && (
            <div className="relative z-10 mx-auto max-w-5xl px-4 pb-4">
              <div className="text-xs text-white/60 mb-2">노드별 슬라이드(이미지+텍스트)를 편집해 보세요. 편집 모드를 켜야 수정 가능합니다.</div>
              <div className="flex items-center gap-2 mb-3">
                <button onClick={()=>setEditMode(v=>!v)} className={"text-xs md:text-sm px-3 py-1.5 rounded-xl border " + (editMode ? 'bg-teal-500/20 border-teal-400/40' : 'bg-white/10 hover:bg-white/15 border-white/15')}>{editMode ? '편집 모드: ON' : '편집 모드'}</button>
                <button onClick={()=>{ const a=document.createElement('a'); a.href=bgHref; a.target='_blank'; a.rel='noreferrer'; a.click(); }} className="text-xs md:text-sm px-3 py-1.5 rounded-xl bg-white/10 hover:bg-white/15 border border-white/15">배경 보기</button>
              </div>

              <div className="grid md:grid-cols-2 gap-4">
                {items.map((it, i) => (
                  <div key={i} className={"rounded-xl border p-3 " + (editMode ? "border-white/15 bg-white/5" : "border-white/10 bg-white/3 opacity-70")}>
                    <div className="text-xs text-white/70 mb-2">노드 {i+1} – {it.key}</div>
                    <div className="grid grid-cols-3 gap-2">
                      <label className="col-span-1 text-xs text-white/70">제목</label>
                      <input disabled={!editMode} className="col-span-2 bg-black/30 border border-white/15 rounded-md px-2 py-1 text-sm disabled:opacity-60 disabled:cursor-not-allowed"
                        value={it.label} onChange={(e)=>setItems(items.map((p,j)=> j===i?{...p,label:e.target.value}:p))} />
                      <label className="col-span-1 text-xs text-white/70">설명</label>
                      <input disabled={!editMode} className="col-span-2 bg-black/30 border border-white/15 rounded-md px-2 py-1 text-sm disabled:opacity-60 disabled:cursor-not-allowed"
                        value={it.desc} onChange={(e)=>setItems(items.map((p,j)=> j===i?{...p,desc:e.target.value}:p))} />
                      <label className="col-span-1 text-xs text-white/70">링크</label>
                      <input disabled={!editMode} className="col-span-2 bg-black/30 border border-white/15 rounded-md px-2 py-1 text-sm disabled:opacity-60 disabled:cursor-not-allowed"
                        value={it.href} onChange={(e)=>setItems(items.map((p,j)=> j===i?{...p,href:e.target.value}:p))} />
                    </div>

                    {/* 슬라이드 편집 */}
                    <div className="mt-3 border-t border-white/10 pt-3">
                      <div className="flex items-center justify-between mb-2">
                        <div className="text-xs text-white/70">슬라이드(PPT 스타일)</div>
                        <div className="flex items-center gap-2">
                          <button disabled={!editMode} onClick={()=>{
                            if(!editMode) return;
                            setItems(items.map((p,j)=>{
                              if(j!==i) return p;
                              const deck = Array.isArray(p.deck) ? p.deck.slice() : [];
                              deck.push({ title: "새 슬라이드", text: "내용을 입력하세요", image: "" });
                              return { ...p, deck };
                            }));
                          }} className="px-2 py-1 text-xs rounded bg-white/10 hover:bg-white/15 border border-white/15 disabled:opacity-60">추가</button>
                          <button disabled={!editMode} onClick={()=>{
                            if(!editMode) return;
                            setItems(items.map((p,j)=>{
                              if(j!==i) return p;
                              const deck = Array.isArray(p.deck) ? p.deck.slice() : [];
                              deck.pop();
                              return { ...p, deck };
                            }));
                          }} className="px-2 py-1 text-xs rounded bg-white/10 hover:bg-white/15 border border-white/15 disabled:opacity-60">마지막 삭제</button>
                        </div>
                      </div>

                      <div className="space-y-3">
                        {(it.deck||[]).map((s, sidx)=>(
                          <div key={sidx} className="rounded-lg border border-white/10 p-2">
                            <div className="grid grid-cols-3 gap-2 items-center">
                              <label className="text-xs text-white/70">슬라이드 제목</label>
                              <input disabled={!editMode} className="col-span-2 bg-black/30 border border-white/15 rounded-md px-2 py-1 text-sm"
                                value={s.title||''} onChange={(e)=>{
                                  if(!editMode) return;
                                  const v=e.target.value;
                                  setItems(items.map((p,j)=>{
                                    if(j!==i) return p;
                                    const deck = (p.deck||[]).slice();
                                    deck[sidx] = { ...(deck[sidx]||{}), title: v };
                                    return { ...p, deck };
                                  }));
                                }} />
                              <label className="text-xs text-white/70">텍스트</label>
                              <textarea disabled={!editMode} rows="3" className="col-span-2 bg-black/30 border border-white/15 rounded-md px-2 py-1 text-sm"
                                value={s.text||''} onChange={(e)=>{
                                  if(!editMode) return;
                                  const v=e.target.value;
                                  setItems(items.map((p,j)=>{
                                    if(j!==i) return p;
                                    const deck = (p.deck||[]).slice();
                                    deck[sidx] = { ...(deck[sidx]||{}), text: v };
                                    return { ...p, deck };
                                  }));
                                }} />
                              <label className="text-xs text-white/70">이미지</label>
                              <div className="col-span-2 flex items-center gap-2">
                                <input disabled={!editMode} type="file" accept="image/*" className="hidden" id={`img${i}-${sidx}`}
                                  onChange={(e)=> upsertSlideImage(i, sidx, e.target?.files?.[0]) } />
                                <label htmlFor={`img${i}-${sidx}`} className={"px-2 py-1 text-xs rounded border " + (editMode? "bg-white/10 hover:bg-white/15 border-white/15 cursor-pointer":"bg-white/5 border-white/10 opacity-60 cursor-not-allowed")}>이미지 선택</label>
                                {s.image ? <span className="text-xs text-white/60">선택됨</span> : <span className="text-xs text-white/40">없음</span>}
                              </div>
                            </div>
                          </div>
                        ))}
                        {(!it.deck || it.deck.length===0) && (
                          <div className="text-xs text-white/50">슬라이드를 추가하면, 해당 별을 클릭했을 때 이 모달로 보여집니다.</div>
                        )}
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </section>
          )}

          {/* 캔버스 */}
          <section className="relative z-10 mx-auto max-w-5xl w-full px-4 pb-16">
            <div className="relative w-full rounded-2xl border border-white/10 shadow-2xl overflow-hidden" style={{ aspectRatio: '16/9' }}>
              <svg viewBox={`0 0 ${100 * (16/9)} 100`} preserveAspectRatio="xMidYMid meet" className="h-full w-full">
                <defs>
                  <linearGradient id="blueCast" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="0%" stopColor="#0e1a3a" />
                    <stop offset="100%" stopColor="#0a0f23" />
                  </linearGradient>
                  <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="1.1" result="coloredBlur" />
                    <feMerge><feMergeNode in="coloredBlur" /><feMergeNode in="SourceGraphic" /></feMerge>
                  </filter>
                  <style>{`
                    svg *:focus { outline: none; }
                    @keyframes sparkle { 0% { opacity: 0; transform: scale(0.7); } 20% { opacity: 1; } 100% { opacity: 0; transform: scale(1.35); } }
                    .spark-burst { pointer-events: none; }
                    .spark { transform-origin: center; animation: sparkle 550ms ease-out forwards; }
                  `}</style>
                </defs>

                {(customBgDataUrl || backgroundImageUrl) && bgOk ? (
                  <image href={(customBgDataUrl || backgroundImageUrl)} x="0" y="0" width={100*(16/9)} height="100" preserveAspectRatio="xMidYMid slice" crossOrigin="anonymous" onError={()=>setBgOk(false)} />
                ) : (
                  <rect x="0" y="0" width={100*(16/9)} height="100" fill="#0b1024" />
                )}
                <rect x="0" y="0" width={100*(16/9)} height="100" fill="url(#blueCast)" opacity="0.25" />

                <polyline points={points} fill="none" stroke="rgba(255,255,255,0.18)" strokeWidth="0.55" strokeLinejoin="round" strokeLinecap="round" vectorEffect="non-scaling-stroke" filter="url(#glow)" />
                <polyline points={points} fill="none" stroke="rgba(255,255,255,0.35)" strokeWidth="0.35" strokeLinejoin="round" strokeLinecap="round" vectorEffect="non-scaling-stroke" filter="url(#glow)" />

                {nodes.map((n, idx) => (
                  <g key={idx} transform={`translate(${n.x} ${n.y})`} style={{cursor:'pointer'}}
                     onClick={()=>openNode(idx)}
                     onMouseEnter={()=>setActive({ label: items[idx]?.label, desc: items[idx]?.desc })}
                     onMouseLeave={()=>setActive(null)}>
                    <title>{items[idx]?.label || ''}</title>
                    <circle r="4.8" fill="transparent" />
                    <circle r="1.15" fill="rgba(255,255,255,0.20)">
                      <animate attributeName="r" values={`1.15;2.05;1.15`} dur="2.6s" repeatCount="indefinite" />
                      <animate attributeName="opacity" values="0.22;0.12;0.22" dur="2.6s" repeatCount="indefinite" />
                    </circle>
                    <circle r="0.48" fill="#ffffff" filter="url(#glow)">
                      <animate attributeName="r" values={`0.48;0.82;0.48`} dur="1.7s" repeatCount="indefinite" />
                    </circle>
                  </g>
                ))}
              </svg>

              {/* 정보 패널 */}
              <div className="pointer-events-none absolute right-3 bottom-3 md:right-4 md:bottom-4">
                <div className={("transition-all duration-200 backdrop-blur-md rounded-xl border border-white/15 shadow-lg " + (active ? 'bg-black/35 opacity-100 translate-y-0' : 'bg-black/20 opacity-0 translate-y-2') + ' max-w-[70vw] md:max-w-sm')} style={{ pointerEvents: 'none' }}>
                  <div className="px-4 py-3">
                    <div className="text-xs uppercase tracking-wider text-white/60">Project</div>
                    <div className="mt-0.5 text-base md:text-lg font-medium">{active?.label || '노드에 마우스를 올려보세요'}</div>
                    <div className="mt-1 text-xs md:text-sm text-white/75 leading-snug line-clamp-3">{active?.desc || '우측하단에 프로젝트 이름과 설명이 표시됩니다.'}</div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <DeckModal open={deckOpen} onClose={()=>setDeckOpen(false)} deck={items[deckNode]?.deck || []} idx={deckSlide} setIdx={setDeckSlide} />
        </main>
      );
    }

    function App(){ return <BigDipperPortfolio />; }
    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
